# Brain-Inspired AI Makefile
# =========================

.PHONY: help install dev-install test lint format clean build docker-build docker-run docs serve demo github-setup release-patch release-minor release-major docs-deploy deploy-all

# é»˜è®¤ç›®æ ‡
help:
	@echo "Brain-Inspired AI Framework - å¯ç”¨å‘½ä»¤:"
	@echo ""
	@echo "ç¯å¢ƒè®¾ç½®:"
	@echo "  install           - å®‰è£…é¡¹ç›®ä¾èµ–"
	@echo "  dev-install       - å®‰è£…å¼€å‘ä¾èµ–"
	@echo "  clean            - æ¸…ç†æ„å»ºæ–‡ä»¶å’Œç¼“å­˜"
	@echo ""
	@echo "å¼€å‘:"
	@echo "  test             - è¿è¡Œæµ‹è¯•"
	@echo "  test-coverage    - è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š"
	@echo "  lint             - ä»£ç è´¨é‡æ£€æŸ¥"
	@echo "  format           - ä»£ç æ ¼å¼åŒ–"
	@echo "  type-check       - ç±»å‹æ£€æŸ¥"
	@echo ""
	@echo "æ„å»ºå’Œéƒ¨ç½²:"
	@echo "  build            - æ„å»ºé¡¹ç›®"
	@echo "  docker-build     - æ„å»ºDockeré•œåƒ"
	@echo "  docker-run       - è¿è¡ŒDockerå®¹å™¨"
	@echo "  serve            - å¯åŠ¨å¼€å‘æœåŠ¡å™¨"
	@echo "  demo             - è¿è¡Œæ¼”ç¤ºç¨‹åº"
	@echo ""
	@echo "æ–‡æ¡£:"
	@echo "  docs             - ç”Ÿæˆæ–‡æ¡£"
	@echo "  docs-serve       - å¯åŠ¨æ–‡æ¡£æœåŠ¡å™¨"
	@echo ""

# ç¯å¢ƒå˜é‡
PYTHON := python3
PIP := pip
VENV_DIR := venv
PYTEST := pytest
BLACK := black
FLAKE8 := flake8
MYPY := mypy

# é¡¹ç›®ä¿¡æ¯
PROJECT_NAME := brain_ai
SRC_DIR := src
TESTS_DIR := tests
DOCS_DIR := docs
CONFIG_DIR := config

# å®‰è£…ä¾èµ–
install:
	@echo "ğŸ“¦ å®‰è£…é¡¹ç›®ä¾èµ–..."
	$(PIP) install --upgrade pip
	$(PIP) install -r requirements.txt
	$(PIP) install -e .

dev-install:
	@echo "ğŸ› ï¸ å®‰è£…å¼€å‘ä¾èµ–..."
	$(PIP) install --upgrade pip
	$(PIP) install -r requirements.txt
	$(PIP) install -e .
	$(PIP) install -r requirements-dev.txt

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
venv:
	@echo "ğŸ åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ..."
	$(PYTHON) -m venv $(VENV_DIR)
	@echo "è™šæ‹Ÿç¯å¢ƒå·²åˆ›å»ºã€‚è¯·è¿è¡Œ: source $(VENV_DIR)/bin/activate"

# æ¸…ç†
clean:
	@echo "ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶..."
	rm -rf build/
	rm -rf dist/
	rm -rf *.egg-info/
	rm -rf __pycache__/
	rm -rf .pytest_cache/
	rm -rf .mypy_cache/
	rm -rf .coverage
	rm -rf htmlcov/
	find . -name "*.pyc" -delete
	find . -name "__pycache__" -type d -exec rm -rf {} +
	rm -rf logs/*

clean-all: clean
	@echo "ğŸ§¹ æ¸…ç†æ‰€æœ‰æ–‡ä»¶..."
	rm -rf $(VENV_DIR)/
	rm -rf models/*
	rm -rf data/cache/*
	rm -rf output/*

# æµ‹è¯•
test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	$(PYTEST) $(TESTS_DIR)/ -v

test-coverage:
	@echo "ğŸ“Š è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š..."
	$(PYTEST) $(TESTS_DIR)/ -v --cov=$(SRC_DIR)/$(PROJECT_NAME) --cov-report=html --cov-report=term

test-fast:
	@echo "âš¡ å¿«é€Ÿæµ‹è¯•..."
	$(PYTEST) $(TESTS_DIR)/ -v -x --tb=short

# ä»£ç è´¨é‡
lint:
	@echo "ğŸ” ä»£ç è´¨é‡æ£€æŸ¥..."
	$(FLAKE8) $(SRC_DIR)/$(PROJECT_NAME) $(TESTS_DIR)/ --max-line-length=88 --extend-ignore=E203,W503

format:
	@echo "âœ¨ ä»£ç æ ¼å¼åŒ–..."
	$(BLACK) $(SRC_DIR)/$(PROJECT_NAME) $(TESTS_DIR)/ --line-length=88

format-check:
	@echo "ğŸ” æ£€æŸ¥ä»£ç æ ¼å¼..."
	$(BLACK) $(SRC_DIR)/$(PROJECT_NAME) $(TESTS_DIR)/ --check --line-length=88

type-check:
	@echo "ğŸ” ç±»å‹æ£€æŸ¥..."
	$(MYPY) $(SRC_DIR)/$(PROJECT_NAME)/

quality: lint format-check type-check
	@echo "âœ… ä»£ç è´¨é‡æ£€æŸ¥å®Œæˆ"

# æ„å»º
build:
	@echo "ğŸ—ï¸ æ„å»ºé¡¹ç›®..."
	$(PYTHON) setup.py sdist bdist_wheel

build-clean: clean build

# Docker
docker-build:
	@echo "ğŸ³ æ„å»ºDockeré•œåƒ..."
	docker build -t brain-ai:latest .

docker-run:
	@echo "ğŸš€ è¿è¡ŒDockerå®¹å™¨..."
	docker run -p 8080:8080 -v $$(pwd)/data:/app/data -v $$(pwd)/models:/app/models brain-ai:latest

docker-compose-up:
	@echo "ğŸš€ å¯åŠ¨Docker ComposeæœåŠ¡..."
	docker-compose up -d

docker-compose-down:
	@echo "ğŸ›‘ åœæ­¢Docker ComposeæœåŠ¡..."
	docker-compose down

# æœåŠ¡å™¨
serve:
	@echo "ğŸŒ å¯åŠ¨å¼€å‘æœåŠ¡å™¨..."
	$(PYTHON) -m brain_ai.scripts.serve --config $(CONFIG_DIR)/development.yaml --host 127.0.0.1 --port 8000

serve-prod:
	@echo "ğŸŒ å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨..."
	$(PYTHON) -m brain_ai.scripts.serve --config $(CONFIG_DIR)/production.yaml --host 0.0.0.0 --port 8080

# æ¼”ç¤º
demo:
	@echo "ğŸ¯ è¿è¡Œæ¼”ç¤ºç¨‹åº..."
	$(PYTHON) -m brain_ai.scripts.demo --type basic --interactive

demo-advanced:
	@echo "ğŸ¯ è¿è¡Œé«˜çº§æ¼”ç¤º..."
	$(PYTHON) -m brain_ai.scripts.demo --type advanced

demo-full:
	@echo "ğŸ¯ è¿è¡Œå®Œæ•´æ¼”ç¤º..."
	$(PYTHON) -m brain_ai.scripts.demo --type full

# è®­ç»ƒå’Œè¯„ä¼°
train:
	@echo "ğŸ‹ï¸ å¼€å§‹è®­ç»ƒ..."
	$(PYTHON) -m brain_ai.scripts.train \
		--model-type hippocampus \
		--epochs 50 \
		--batch-size 16 \
		--learning-rate 0.001 \
		--output-dir ./output

eval:
	@echo "ğŸ“Š å¼€å§‹è¯„ä¼°..."
	$(PYTHON) -m brain_ai.scripts.evaluate \
		--model-path ./output/hippocampus_model.pkl \
		--test-data ./data/test.csv \
		--output-dir ./evaluation_results

# æ–‡æ¡£
docs:
	@echo "ğŸ“š ç”Ÿæˆæ–‡æ¡£..."
	cd $(DOCS_DIR) && make html

docs-serve:
	@echo "ğŸ“š å¯åŠ¨æ–‡æ¡£æœåŠ¡å™¨..."
	cd $(DOCS_DIR)/_build/html && $(PYTHON) -m http.server 8081

docs-clean:
	@echo "ğŸ§¹ æ¸…ç†æ–‡æ¡£..."
	cd $(DOCS_DIR) && make clean

# æ•°æ®å¤„ç†
data-download:
	@echo "ğŸ“¥ ä¸‹è½½ç¤ºä¾‹æ•°æ®..."
	$(PYTHON) -m brain_ai.scripts.data download --url https://example.com/dataset.zip

data-process:
	@echo "ğŸ”„ å¤„ç†æ•°æ®..."
	$(PYTHON) -m brain_ai.scripts.data process --input ./data/raw --output ./data/processed

# ç›‘æ§
logs:
	@echo "ğŸ“‹ æŸ¥çœ‹æ—¥å¿—..."
	tail -f logs/brain_ai.log

logs-errors:
	@echo "âŒ æŸ¥çœ‹é”™è¯¯æ—¥å¿—..."
	grep "ERROR" logs/brain_ai.log

status:
	@echo "ğŸ“ˆ ç³»ç»ŸçŠ¶æ€æ£€æŸ¥..."
	$(PYTHON) -m brain_ai.scripts.status

# æ€§èƒ½åˆ†æ
benchmark:
	@echo "âš¡ è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•..."
	$(PYTHON) -m brain_ai.scripts.benchmark --model hippocampus --dataset test_data

profile:
	@echo "ğŸ“Š æ€§èƒ½åˆ†æ..."
	$(PYTHON) -m brain_ai.scripts.profile --memory --cpu --model neocortex

# é…ç½®ç®¡ç†
config-show:
	@echo "âš™ï¸ æ˜¾ç¤ºå½“å‰é…ç½®..."
	$(PYTHON) -m brain_ai.scripts.config show

config-validate:
	@echo "âœ… éªŒè¯é…ç½®æ–‡ä»¶..."
	$(PYTHON) -m brain_ai.scripts.config validate --config $(CONFIG_DIR)/development.yaml

# æ¨¡å‹ç®¡ç†
model-list:
	@echo "ğŸ“‹ åˆ—å‡ºå¯ç”¨æ¨¡å‹..."
	$(PYTHON) -m brain_ai.scripts.model list

model-info:
	@echo "â„¹ï¸ æ¨¡å‹ä¿¡æ¯..."
	$(PYTHON) -m brain_ai.scripts.model info --model hippocampus

model-convert:
	@echo "ğŸ”„ è½¬æ¢æ¨¡å‹æ ¼å¼..."
	$(PYTHON) -m brain_ai.scripts.model convert \
		--input ./models/hippocampus.pth \
		--output ./models/hippocortex.onnx \
		--format onnx

# æ¸…ç†å’Œç»´æŠ¤
update-deps:
	@echo "ğŸ”„ æ›´æ–°ä¾èµ–åŒ…..."
	$(PIP) list --outdated
	$(PIP) install --upgrade pip
	$(PIP) install -r requirements.txt

backup:
	@echo "ğŸ’¾ å¤‡ä»½æ•°æ®..."
	tar -czf backup_$(shell date +%Y%m%d_%H%M%S).tar.gz \
		--exclude='.git' \
		--exclude='__pycache__' \
		--exclude='*.pyc' \
		--exclude='logs/*.log' \
		--exclude='data/cache/*' \
		data/ models/ output/ config/

# å¼€å‘å·¥ä½œæµ
dev-setup: clean venv dev-install
	@echo "ğŸš€ å¼€å‘ç¯å¢ƒè®¾ç½®å®Œæˆï¼"
	@echo "è¯·è¿è¡Œ: source $(VENV_DIR)/bin/activate"

dev-test: lint format-check type-check test
	@echo "âœ… å¼€å‘æµ‹è¯•é€šè¿‡ï¼"

pre-commit: clean lint format-check type-check test
	@echo "âœ… æäº¤å‰æ£€æŸ¥å®Œæˆï¼"

# ç”Ÿäº§éƒ¨ç½²
prod-build: clean build
	@echo "ğŸ—ï¸ ç”Ÿäº§ç‰ˆæœ¬æ„å»ºå®Œæˆï¼"

prod-deploy:
	@echo "ğŸš€ å¼€å§‹ç”Ÿäº§éƒ¨ç½²..."
	./scripts/deploy.sh deploy production

# å¿«é€Ÿå¯åŠ¨
quick-start: install
	@echo "ğŸ¯ å¿«é€Ÿå¯åŠ¨..."
	$(PYTHON) -c "from brain_ai import HippocampusSimulator; h = HippocampusSimulator(); print('âœ… Brain-Inspired AI å®‰è£…æˆåŠŸï¼')"

# æ¸…ç†æ‰€æœ‰Dockerç›¸å…³
docker-clean:
	@echo "ğŸ³ æ¸…ç†Dockerèµ„æº..."
	docker system prune -f
	docker volume prune -f

# æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯
info:
	@echo "ğŸ§  Brain-Inspired AI Framework"
	@echo "ç‰ˆæœ¬: $$(python -c "import sys; sys.path.insert(0, 'src'); from brain_ai import __version__; print(__version__)")"
	@echo "Pythonç‰ˆæœ¬: $$(python --version)"
	@echo "PyTorchç‰ˆæœ¬: $$(python -c 'import torch; print(torch.__version__)')"
	@echo "CUDAå¯ç”¨: $$(python -c 'import torch; print(torch.cuda.is_available())')"
	@echo "GPUæ•°é‡: $$(python -c 'import torch; print(torch.cuda.device_count())')"

# GitHubéƒ¨ç½²
github-setup:
	@echo "ğŸš€ è®¾ç½®GitHubä»“åº“ç»“æ„..."
	python scripts/setup_github_repo.py --comprehensive
	@echo "âœ… GitHubä»“åº“è®¾ç½®å®Œæˆï¼"

release-patch:
	@echo "ğŸ“¦ å‘å¸ƒè¡¥ä¸ç‰ˆæœ¬..."
	python scripts/release/manager.py release --auto
	@echo "âœ… è¡¥ä¸ç‰ˆæœ¬å‘å¸ƒå®Œæˆï¼"

release-minor:
	@echo "ğŸ“¦ å‘å¸ƒæ¬¡è¦ç‰ˆæœ¬..."
	python scripts/release/manager.py version --increment minor
	@echo "âœ… æ¬¡è¦ç‰ˆæœ¬: $$(python scripts/release/manager.py version --show)"
	@echo "âš ï¸  è¯·æäº¤æ›´æ”¹å¹¶æ‰‹åŠ¨åˆ›å»ºå‘å¸ƒ"

release-major:
	@echo "ğŸ“¦ å‘å¸ƒä¸»è¦ç‰ˆæœ¬..."
	python scripts/release/manager.py version --increment major
	@echo "âœ… ä¸»è¦ç‰ˆæœ¬: $$(python scripts/release/manager.py version --show)"
	@echo "âš ï¸  è¯·æäº¤æ›´æ”¹å¹¶æ‰‹åŠ¨åˆ›å»ºå‘å¸ƒ"

docs-deploy:
	@echo "ğŸš€ éƒ¨ç½²æ–‡æ¡£åˆ°GitHub Pages..."
	@echo "è¯·ç¡®ä¿å·²é…ç½®GitHub Pageså¹¶è¿è¡Œ: mkdocs gh-deploy"

deploy-all: clean github-setup test lint format-check build docs docs-deploy
	@echo "ğŸ‰ å®Œæ•´éƒ¨ç½²æµç¨‹å®Œæˆï¼"
	@echo ""
	@echo "ğŸ“‹ åç»­æ­¥éª¤:"
	@echo "1. å®¡æŸ¥ç”Ÿæˆçš„é…ç½®æ–‡ä»¶"
	@echo "2. æäº¤å¹¶æ¨é€æ›´æ”¹"
	@echo "3. é…ç½®GitHubä»“åº“è®¾ç½®"
	@echo "4. å¯ç”¨GitHub Pages"
	@echo "5. è®¾ç½®ä»“åº“å¯†é’¥"
	@echo "6. é…ç½®åˆ†æ”¯ä¿æŠ¤è§„åˆ™"

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
.DEFAULT_GOAL := help